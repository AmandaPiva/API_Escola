<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>üöóLista de Ve√≠culos</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-8">
                <h1>üöóLista de Ve√≠culos</h1>
                <table class="table">
                    <thead class="bg-success text-white">
                        <tr>
                            <th>C√≥digo</th>
                            <th>Placa</th>
                            <th>Nome</th>
                            <th>Descri√ß√£o</th>
                            <th>Pre√ßo</th>
                            <th>Inclus√£o</th>
                            <th>Fabrica√ß√£o</th>
                            <th>Tempo de Uso</th>
                            <th>Op√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div> <!-- fim da 1a coluna -->
            <div class="col-md-4">
                <h1>üöôNovo Ve√≠culo</h1>
                <form id="form-veiculo">
                    <div class="mb-3">
                        <label for="codigo" class="form-label">C√≥digo</label>
                        <input type="number" class="form-control" id="codigo" name="codigo" readonly
                            placeholder="Autom√°tico">
                    </div>
                    <div class="mb-3">
                        <label for="placa" class="form-label">Placa</label>
                        <input type="text" class="form-control" id="placa" name="placa" autofocus required title="A placa deve estar no formato AAA9999"
                        pattern="[A-Z]{3}[0-9][A-Z0-9][0-9]{2}" maxlength="7" placeholder="AAA9999">
                    </div>
                    <div class="mb-3">
                        <label for="nome" class="form-label">Nome</label>
                        <input type="text" class="form-control" id="nome" name="nome" required>
                    </div>
                    <div class="mb-3">
                        <label for="preco" class="form-label">Pre√ßo</label>
                        <input type="number" class="form-control" id="preco" name="preco" min="0" required>
                    </div>
                    <div class="mb-3">
                        <label for="descricao" class="form-label">Descri√ß√£o</label>
                        <textarea class="form-control" id="descricao" name="descricao" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="fabricacao" class="form-label">Fabrica√ß√£o</label>
                        <input type="date" class="form-control" id="fabricacao" name="fabricacao" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                    <button type="reset" class="btn btn-danger">Limpar</button>
                </form>
            </div>
        </div> <!-- fim da linha -->
    </div> <!-- fim do container -->

    <script>
        // Listagem dos Dados     
        const tbody = document.querySelector('table tbody');
        fetch('http://localhost:4000/api/aluno')
            .then(response => response.json())
            .then(data => {
                data.forEach(veiculo => {
                    const row = document.createElement('tr');
                    const codigoCell = document.createElement('td');
                    codigoCell.textContent = veiculo['AlunoRa'];
                    const placaCell = document.createElement('td');
                    placaCell.textContent = veiculo['cpf'];
                    const nomeCell = document.createElement('td');
                    nomeCell.textContent = veiculo['Nome'];
                    const descricaoCell = document.createElement('td');
                    descricaoCell.textContent = veiculo['Descri√ß√£o'];
                    const precoCell = document.createElement('td');
                    precoCell.textContent = veiculo['Pre√ßo'];
                    const inclusaoCell = document.createElement('td');
                    inclusaoCell.textContent = veiculo['Inclus√£o'];
                    const fabricacaoCell = document.createElement('td');
                    fabricacaoCell.textContent = veiculo['Fabrica√ß√£o'];
                    const tempoDeUsoCell = document.createElement('td');
                    tempoDeUsoCell.textContent = veiculo['Tempo de Uso'];
                    
                    row.appendChild(codigoCell);
                    row.appendChild(placaCell);
                    row.appendChild(nomeCell);
                    row.appendChild(descricaoCell);
                    row.appendChild(precoCell);
                    row.appendChild(inclusaoCell);
                    row.appendChild(fabricacaoCell);
                    row.appendChild(tempoDeUsoCell);
/* Bot√£o Apagar */
const deleteButton = document.createElement('button');
deleteButton.textContent = 'Apagar';
deleteButton.classList.add('btn', 'btn-danger', 'btn-sm');
deleteButton.addEventListener('click', () => apagarVeiculo(veiculo.Placa));

const deleteCell = row.insertCell();
deleteCell.appendChild(deleteButton);


                    tbody.appendChild(row);
                });
            })
            .catch(error => console.error(error));

        //Inclus√£o de um novo registro
        const form = document.querySelector('#form-veiculo');
        form.addEventListener('submit', function (event) {
            event.preventDefault();

            const codigo = form.codigo.value;
            const placa = form.placa.value;
            const nome = form.nome.value;
            const descricao = form.descricao.value;
            const fabricacao = form.fabricacao.value;
            const preco = form.preco.value;

            const data = {
                'placa': placa,
                'nome': nome,
                'descricao': descricao,
                'fabricacao': fabricacao,
                'preco': preco
            };

            fetch('http://localhost:4000/api/veiculos', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(data => {
                    // Aqui voc√™ pode fazer algo com a resposta, como atualizar a lista de ve√≠culos exibida na p√°gina
                    alert(JSON.stringify(data))
                    location.reload();
                })
                .catch(error => {
                    console.error(error)
                }
                );
        });
// Exclus√£o dos Dados
function apagarVeiculo(placa) {
  const confirmacao = confirm(`Tem certeza de que deseja excluir o ve√≠culo placa ${placa}?`);

  if (confirmacao) {
    fetch(`http://localhost:4000/api/veiculos/${placa}`, {
      method: 'DELETE'
    })
    .then(response => {
      if (response.ok) {
        alert('Ve√≠culo exclu√≠do com sucesso!');
        location.reload();
      } else {
        throw new Error('N√£o foi poss√≠vel excluir o ve√≠culo.');
      }
    })
    .catch(error => {
      console.error(error);
      alert('N√£o foi poss√≠vel excluir o ve√≠culo.');
    });
  }
}

    </script>

</body>

</html>